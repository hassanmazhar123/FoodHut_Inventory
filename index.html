<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Modern Inventory Management System - Products & Raw Materials">
    <title>Inventory Manager | Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="assets/favicon.png">
</head>

<body>
    <!-- Setup Modal (Connection) -->
    <div id="setupModal" class="modal">
        <div class="modal-content setup-modal">
            <div class="modal-header">
                <h2>üîó Connect to Google Sheets</h2>
            </div>
            <div class="modal-body">
                <p class="setup-info">Enter your Google Apps Script Web App URL to connect your inventory sheet.</p>
                <div class="form-group">
                    <label for="setupScriptUrl">Apps Script Web App URL</label>
                    <input type="url" id="setupScriptUrl" placeholder="https://script.google.com/macros/s/...../exec"
                        required>
                </div>
                <button class="btn btn-primary btn-lg" onclick="saveInitialSetup()" style="width: 100%;">
                    <span class="btn-icon">‚úì</span> Connect
                </button>
                <div class="setup-help">
                    <details>
                        <summary>üìñ Setup Instructions</summary>
                        <ol>
                            <li>Create a new Google Sheet</li>
                            <li>Go to <strong>Extensions ‚Üí Apps Script</strong></li>
                            <li>Paste the Code.gs content provided</li>
                            <li>Run <code>setupSheet()</code> function once</li>
                            <li>Click <strong>Deploy ‚Üí New Deployment</strong></li>
                            <li>Select <strong>Web App</strong>, set access to <strong>Anyone</strong></li>
                            <li>Copy the URL and paste above</li>
                        </ol>
                    </details>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content login-modal">
            <div class="modal-header">
                <h2>üë§ Account Login</h2>
            </div>
            <div class="modal-body">
                <form id="loginForm" onsubmit="handleLoginSubmit(event)">
                    <div class="form-group">
                        <label for="loginUsername">Username</label>
                        <input type="text" id="loginUsername" placeholder="Enter username" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPin">Access Password</label>
                        <div class="password-input-group">
                            <input type="password" id="loginPin" placeholder="Enter your password" required>
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('loginPin')"
                                aria-label="Toggle password visibility">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="eye-icon">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">
                        Login to System
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Setup Modal -->
    <div id="adminSetupModal" class="modal">
        <div class="modal-content login-modal">
            <div class="modal-header">
                <h2>üöÄ First Time Setup</h2>
            </div>
            <div class="modal-body">
                <p class="setup-info">Create your administrator account to get started.</p>
                <form id="adminSetupForm" onsubmit="handleAdminSetupSubmit(event)">
                    <div class="form-group">
                        <label for="adminUsername">Admin Username</label>
                        <input type="text" id="adminUsername" placeholder="Choose a username" required>
                    </div>
                    <div class="form-group">
                        <label for="adminPin">Set Access Password</label>
                        <div class="password-input-group">
                            <input type="password" id="adminPin" placeholder="Enter your password" required>
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('adminPin')"
                                aria-label="Toggle password visibility">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="eye-icon">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">
                        Create Admin Account
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="app-container hidden">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <button id="sidebarToggle" class="sidebar-toggle" onclick="toggleSidebar()" title="Toggle Sidebar">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="toggle-icon">
                    <polyline points="15 18 9 12 15 6" />
                </svg>
            </button>
            <div class="logo">
                <img src="assets/logo.png" alt="Food Hut Homemade" class="logo-image full-logo">
                <img src="assets/logoicon.png" alt="Food Hut" class="logo-image icon-logo">
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-view="dashboard">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="nav-icon">
                        <rect width="7" height="9" x="3" y="3" rx="1" />
                        <rect width="7" height="5" x="14" y="3" rx="1" />
                        <rect width="7" height="9" x="14" y="12" rx="1" />
                        <rect width="7" height="5" x="3" y="16" rx="1" />
                    </svg>
                    <span>Dashboard</span>
                </a>

                <a href="#" class="nav-item" data-view="overview">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="nav-icon">
                        <path d="M3 3v18h18" />
                        <path d="m19 9-5 5-4-4-3 3" />
                    </svg>
                    <span>Overview</span>
                </a>

                <a href="#" class="nav-item" data-view="products">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="nav-icon">
                        <path d="m7.5 4.27 9 5.15" />
                        <path
                            d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z" />
                        <path d="m3.3 7 8.7 5 8.7-5" />
                        <path d="M12 22V12" />
                    </svg>
                    <span>Product Stock</span>
                </a>

                <a href="#" class="nav-item" data-view="materials">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="nav-icon">
                        <path d="M4.5 3h15" />
                        <path d="M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3" />
                        <path d="M6 14h12" />
                    </svg>
                    <span>Raw Materials</span>
                </a>

                <a href="#" class="nav-item" data-view="logs" id="navLogs">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="nav-icon">
                        <path d="M12 8v4l3 3" />
                        <circle cx="12" cy="12" r="10" />
                        <path d="M12 2v2" />
                        <path d="M12 20v2" />
                        <path d="M2 12h2" />
                        <path d="M20 12h2" />
                    </svg>
                    <span>Stock Logs</span>
                </a>

                <a href="#" class="nav-item" data-view="lowstock">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="nav-icon">
                        <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" />
                        <line x1="12" y1="9" x2="12" y2="13" />
                        <line x1="12" y1="17" x2="12.01" y2="17" />
                    </svg>
                    <span>Low Stock</span>
                    <span class="badge" id="lowStockBadge">0</span>
                </a>

                <a href="#" class="nav-item hidden" data-view="users" id="navUsers">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="nav-icon">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                        <circle cx="9" cy="7" r="4" />
                        <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
                        <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                    </svg>
                    <span>User Management</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" title="Update Profile" onclick="openProfileModal()"
                        style="cursor: pointer;">
                        <span id="userAvatarContent">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                                <circle cx="12" cy="7" r="4" />
                            </svg>
                        </span>
                    </div>
                    <span id="userNameDisplay" class="user-name">User</span>
                </div>
                <div class="footer-actions">
                    <button class="btn-action logout" onclick="handleLogout()" title="Logout">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                            <polyline points="16 17 21 12 16 7" />
                            <line x1="21" y1="12" x2="9" y2="12" />
                        </svg>
                        <span>Logout</span>
                    </button>
                    <button class="btn-action logout" onclick="openSettingsModal()" title="Settings"
                        style="background: var(--bg-tertiary);">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" />
                            <circle cx="12" cy="12" r="3" />
                        </svg>
                    </button>
                </div>
            </div>
        </aside>

        <div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <h1 id="pageTitle">Dashboard</h1>
                </div>
                <div class="header-right">
                    <!-- Search and Add Item buttons removed -->
                </div>
            </header>


            <!-- Overview View -->
            <section id="overviewView" class="view">
                <div class="header-actions">
                    <div class="date-range-picker">
                        <input type="date" id="overviewStartDate" class="form-input overview-date-input">
                        <span style="color: var(--text-muted);">to</span>
                        <input type="date" id="overviewEndDate" class="form-input overview-date-input">
                        <button class="btn-apply" onclick="loadOverviewData()">Apply</button>
                    </div>
                </div>

                <div id="overviewSummary" class="overview-summary-container">
                    <div class="overview-category-row">
                        <h4>Products</h4>
                        <div class="overview-stats-grid three-cols">
                            <div class="stat-card">
                                <span class="stat-label">Total In</span>
                                <span class="stat-value text-success" id="ovProductIn">0</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Total Out</span>
                                <span class="stat-value text-danger" id="ovProductOut">0</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Total Returns</span>
                                <span class="stat-value text-warning" id="ovProductReturn">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="overview-category-row">
                        <h4>Raw Materials</h4>
                        <div class="overview-stats-grid three-cols">
                            <div class="stat-card">
                                <span class="stat-label">Total In</span>
                                <span class="stat-value text-success" id="ovMaterialIn">0</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Total Out</span>
                                <span class="stat-value text-danger" id="ovMaterialOut">0</span>
                            </div>
                            <!-- Spacer to keep grid alignment -->
                            <div class="stat-card" style="visibility: hidden;"></div>
                        </div>
                    </div>
                </div>

                <div class="overview-details-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>Product Movement</h3>
                        </div>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Item Name</th>
                                        <th class="text-center">In</th>
                                        <th class="text-center">Out</th>
                                        <th class="text-center">Return</th>
                                    </tr>
                                </thead>
                                <tbody id="ovProductList"></tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Material Movement</h3>
                        </div>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Item Name</th>
                                        <th class="text-center">In</th>
                                        <th class="text-center">Out</th>
                                    </tr>
                                </thead>
                                <tbody id="ovMaterialList"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Dashboard View -->
            <section id="dashboardView" class="view active">
                <!-- Connection Warning Banner -->
                <div id="connectionWarning" class="alert-banner hidden">
                    <div class="alert-banner-content">
                        <span>‚ö†Ô∏è System not connected to Google Sheets.</span>
                        <button id="alertSettingsBtn" class="btn btn-sm btn-primary" onclick="openSettingsModal()"
                            style="margin-left: 12px;">Connect Now</button>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card" onclick="switchView('products')">
                        <div class="stat-info">
                            <span class="stat-value" id="totalProducts">0</span>
                            <span class="stat-label">Products</span>
                        </div>
                    </div>
                    <div class="stat-card" onclick="switchView('materials')">
                        <div class="stat-info">
                            <span class="stat-value" id="totalMaterials">0</span>
                            <span class="stat-label">Raw Materials</span>
                        </div>
                    </div>
                    <div class="stat-card" onclick="switchView('lowstock')">
                        <div class="stat-info">
                            <span class="stat-value" id="lowStockCount">0</span>
                            <span class="stat-label">Low Stock Items</span>
                        </div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card" onclick="switchView('products')">
                        <div class="stat-info">
                            <span class="stat-value" id="totalProductValue">Rs0</span>
                            <span class="stat-label">Product Value</span>
                        </div>
                    </div>
                    <div class="stat-card" onclick="switchView('materials')">
                        <div class="stat-info">
                            <span class="stat-value" id="totalMaterialValue">Rs0</span>
                            <span class="stat-label">Material Value</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Overview -->
                <div class="dashboard-grid">
                    <!-- Recent Products -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Recent Products</h3>
                            <a href="#" class="link" onclick="switchView('products')">View All ‚Üí</a>
                        </div>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Item Name</th>
                                        <th>Qty</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recentProductsBody"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Recent Materials -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Recent Materials</h3>
                            <a href="#" class="link" onclick="switchView('materials')">View All ‚Üí</a>
                        </div>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Item Name</th>
                                        <th>Qty</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recentMaterialsBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Low Stock Alert -->
                <div class="card alert-card" id="lowStockAlert">
                    <div class="card-header">
                        <h3>Low Stock Alerts</h3>
                    </div>
                    <div class="alert-items" id="lowStockList"></div>
                </div>
            </section>

            <!-- Products View -->
            <section id="productsView" class="view">
                <div class="card">
                    <div class="card-header">
                        <h3>Product Stock</h3>
                        <div class="header-actions">
                            <button class="btn btn-secondary btn-sm" onclick="downloadFullCSV('product')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="btn-icon">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                    <polyline points="7 10 12 15 17 10" />
                                    <line x1="12" y1="15" x2="12" y2="3" />
                                </svg>
                                Export CSV
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="refreshData()"
                                style="margin-left: 8px;">üîÑ Refresh</button>
                            <button class="btn btn-primary btn-sm" onclick="openAddProductModal()"
                                style="margin-left: 8px;">
                                <span class="btn-icon">+</span> Add Product
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table" id="productsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Item Name</th>
                                    <th>Quantity</th>
                                    <th>Unit</th>
                                    <th>Unit Price</th>
                                    <th>Reorder Level</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Materials View -->
            <section id="materialsView" class="view">
                <div class="card materials-card">
                    <div class="card-header">
                        <h3>Raw Materials</h3>
                        <div class="header-actions">
                            <button class="btn btn-secondary btn-sm" onclick="downloadFullCSV('material')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="btn-icon">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                    <polyline points="7 10 12 15 17 10" />
                                    <line x1="12" y1="15" x2="12" y2="3" />
                                </svg>
                                Export CSV
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="refreshData()"
                                style="margin-left: 8px;">üîÑ Refresh</button>
                            <button class="btn btn-primary btn-sm" onclick="openAddMaterialModal()"
                                style="margin-left: 8px;">
                                <span class="btn-icon">+</span> Add Material
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table" id="materialsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Item Name</th>
                                    <th>Quantity</th>
                                    <th>Unit</th>
                                    <th>Unit Price</th>
                                    <th>Reorder Level</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="materialsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Low Stock View -->
            <section id="lowstockView" class="view">
                <div class="card">
                    <div class="card-header">
                        <h3>All Low Stock Items</h3>
                        <div class="header-actions">
                            <button class="btn btn-secondary btn-sm" onclick="downloadLowStockCSV('product')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="btn-icon">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                    <polyline points="7 10 12 15 17 10" />
                                    <line x1="12" y1="15" x2="12" y2="3" />
                                </svg>
                                Download Products CSV
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="downloadLowStockCSV('material')"
                                style="margin-left: 8px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="btn-icon">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                    <polyline points="7 10 12 15 17 10" />
                                    <line x1="12" y1="15" x2="12" y2="3" />
                                </svg>
                                Download Materials CSV
                            </button>
                        </div>
                    </div>

                    <!-- Products Low Stock -->
                    <div class="sub-section">
                        <h4>Products</h4>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Item Name</th>
                                        <th>Current</th>
                                        <th>Reorder At</th>
                                        <th>Shortage</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="lowStockProductsBody"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Materials Low Stock -->
                    <div class="sub-section">
                        <h4>Raw Materials</h4>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Item Name</th>
                                        <th>Current</th>
                                        <th>Reorder At</th>
                                        <th>Shortage</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="lowStockMaterialsBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Logs View -->
            <section id="logsView" class="view">
                <div class="card">
                    <div class="card-header">
                        <div class="header-tabs">
                            <button class="tab-btn active" onclick="switchLogTab('product')">Product Logs</button>
                            <button class="tab-btn" onclick="switchLogTab('material')">Material Logs</button>
                        </div>
                        <button class="btn btn-primary" onclick="openLogEntryModal()">
                            <span class="btn-icon">+</span> New Entry
                        </button>
                    </div>
                    <div class="table-container">
                        <table class="data-table" id="logsTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Item Name</th>
                                    <th>Stock In</th>
                                    <th>Stock Out</th>
                                    <th>Returns</th>
                                    <th>Balance</th>
                                    <th>Notes</th>
                                    <th>User</th>
                                    <th id="logActionsHeader">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="logsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- User Management View -->
            <section id="usersView" class="view">
                <div class="card">
                    <div class="card-header">
                        <h3>User Accounts</h3>
                        <button class="btn btn-primary" onclick="openUserModal()">
                            <span class="btn-icon">+</span> Create User
                        </button>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Full Name</th>
                                    <th>Role</th>
                                    <th>Pin</th>
                                    <th>Created At</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Log Entry Modal -->
    <div id="logEntryModal" class="modal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h2 id="logModalTitle">Bulk Stock Entry</h2>
                <button class="btn-close" onclick="closeModal('logEntryModal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="logEntryForm" onsubmit="handleLogEntrySubmit(event); return false;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="logDate">Date *</label>
                            <input type="date" id="logDate" required>
                        </div>
                        <div class="form-group">
                            <label for="logItemType">Inventory Type *</label>
                            <select id="logItemType" onchange="loadBulkLogItems()">
                                <option value="product">Product Stock</option>
                                <option value="material">Raw Material</option>
                            </select>
                        </div>
                    </div>

                    <div id="batchSelectionArea" class="batch-selection-area hidden">
                        <div class="batch-header">
                            <h4>Material Batches</h4>
                            <button type="button" class="btn btn-secondary btn-sm" onclick="openBatchManagement()">
                                Create Batch
                            </button>
                        </div>
                        <div id="batchList" class="batch-grid">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <div class="bulk-entry-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Item Name</th>
                                    <th width="100">Stock In</th>
                                    <th width="100">Stock Out</th>
                                    <th width="100">Returns</th>
                                    <th>Notes</th>
                                </tr>
                            </thead>
                            <tbody id="bulkLogList">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>

                    <div class="form-actions" style="margin-top: 20px;">
                        <button type="button" class="btn btn-secondary"
                            onclick="closeModal('logEntryModal')">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="handleLogEntrySubmit(event)">Save All
                            Entries</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add/Edit Item Modal -->
    <div id="itemModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add New Item</h2>
                <button class="btn-close" onclick="closeModal('itemModal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="itemForm">
                    <input type="hidden" id="itemId">
                    <div class="form-group" id="itemTypeGroup">
                        <label for="itemTypeSelect">Item Type *</label>
                        <select id="itemTypeSelect" required>
                            <option value="product">Product Stock</option>
                            <option value="material">Raw Material</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="itemName">Item Name *</label>
                        <input type="text" id="itemName" required placeholder="Enter item name">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="itemQuantity">Quantity *</label>
                            <input type="number" id="itemQuantity" required min="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="itemUnit">Unit</label>
                            <select id="itemUnit">
                                <option value="pcs">Pieces (pcs)</option>
                                <option value="kg">Kilograms (kg)</option>
                                <option value="g">Grams (g)</option>
                                <option value="m">Meters (m)</option>
                                <option value="L">Liters (L)</option>
                                <option value="box">Boxes</option>
                                <option value="roll">Rolls</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="itemPrice">Unit Price *</label>
                            <input type="number" id="itemPrice" required min="0" step="0.01" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="itemReorderLevel">Reorder Level</label>
                            <input type="number" id="itemReorderLevel" min="0" value="10">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary"
                            onclick="closeModal('itemModal')">Cancel</button>
                        <button type="button" class="btn btn-primary" id="submitBtn" onclick="triggerFormSubmit()">Add
                            Item</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- User Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="userModalTitle">Create User</h2>
                <button class="btn-close" onclick="closeModal('userModal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="userForm" onsubmit="handleUserFormSubmit(event)">
                    <input type="hidden" id="mgmtUserId">
                    <div class="form-group">
                        <label for="mgmtFullName">Full Name</label>
                        <input type="text" id="mgmtFullName" placeholder="Enter full name">
                    </div>
                    <div class="form-group">
                        <label for="mgmtUsername">Username *</label>
                        <input type="text" id="mgmtUsername" required placeholder="Enter username">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="mgmtPin">Access Password *</label>
                            <div class="password-input-group">
                                <input type="password" id="mgmtPin" required placeholder="Enter your password">
                                <button type="button" class="password-toggle"
                                    onclick="togglePasswordVisibility('mgmtPin')"
                                    aria-label="Toggle password visibility">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="eye-icon">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="mgmtRole">Role *</label>
                            <select id="mgmtRole" required>
                                <option value="Editor">Editor</option>
                                <option value="Admin">Admin</option>
                                <option value="Viewer">Viewer</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary"
                            onclick="closeModal('userModal')">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="userSubmitBtn">Save User</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Stock Adjustment Modal -->
    <div id="stockModal" class="modal">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h2>Adjust Stock</h2>
                <button class="btn-close" onclick="closeModal('stockModal')">√ó</button>
            </div>
            <div class="modal-body">
                <p class="stock-item-name" id="stockItemName">Item Name</p>
                <p class="stock-current">Current: <span id="stockCurrent">0</span> <span id="stockUnit">pcs</span></p>
                <input type="hidden" id="stockItemId">
                <input type="hidden" id="stockItemType">
                <div class="stock-adjust-controls">
                    <button class="btn btn-danger btn-lg" onclick="quickAdjust('remove')">‚àí Remove</button>
                    <input type="number" id="stockAmount" value="1" min="1" class="stock-input">
                    <button class="btn btn-success btn-lg" onclick="quickAdjust('add')">+ Add</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Log Modal -->
    <div id="editLogModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Log Entry</h2>
                <button class="btn-close" onclick="closeModal('editLogModal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="editLogForm" onsubmit="handleEditLogSubmit(event)">
                    <input type="hidden" id="editLogId">
                    <input type="hidden" id="editLogType">
                    <div class="form-group">
                        <label for="editLogDate">Date *</label>
                        <input type="date" id="editLogDate" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editLogStockIn">Stock In</label>
                            <input type="number" id="editLogStockIn" min="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="editLogStockOut">Stock Out</label>
                            <input type="number" id="editLogStockOut" min="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="editLogReturns">Returns</label>
                            <input type="number" id="editLogReturns" min="0" placeholder="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="editLogNotes">Notes</label>
                        <textarea id="editLogNotes" rows="3" placeholder="Enter correction notes..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary"
                            onclick="closeModal('editLogModal')">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>User Profile</h2>
                <button class="btn-close" onclick="closeModal('profileModal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="profileForm" onsubmit="handleProfileUpdate(event)">
                    <div class="profile-pic-section">
                        <div id="profilePicPreview" class="profile-preview">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                stroke-linejoin="round" class="profile-placeholder">
                                <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                                <circle cx="12" cy="7" r="4" />
                            </svg>
                        </div>
                        <div class="profile-pic-controls">
                            <div class="profile-pic-btn-group">
                                <label for="profilePicInput" class="btn btn-secondary btn-sm">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="btn-icon">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                        <polyline points="17 8 12 3 7 8" />
                                        <line x1="12" y1="3" x2="12" y2="15" />
                                    </svg>
                                    Upload Photo
                                </label>
                                <button type="button" class="btn btn-danger btn-sm" id="removePhotoBtn"
                                    onclick="removeProfilePic()" style="display: none;">
                                    Remove Photo
                                </button>
                            </div>
                            <input type="file" id="profilePicInput" accept="image/*" style="display: none;"
                                onchange="previewProfilePic(event)">
                            <p class="text-muted"><small>Max size: 500KB. Squared image works best.</small></p>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="profileFullName" placeholder="Your full name" required>
                    </div>
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="profileUsername" placeholder="Username" required>
                    </div>
                    <div class="form-group">
                        <label>New Access Password (Optional)</label>
                        <div class="password-input-group">
                            <input type="password" id="profilePin" placeholder="Enter your password">
                            <button type="button" class="password-toggle"
                                onclick="togglePasswordVisibility('profilePin')"
                                aria-label="Toggle password visibility">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="eye-icon">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                        <small class="text-muted">Enter a new secure password</small>
                    </div>

                    <div class="form-actions" style="margin-top: 24px;">
                        <button type="button" class="btn btn-secondary"
                            onclick="closeModal('profileModal')">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="profileSubmitBtn">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Settings</h2>
                <button class="btn-close" onclick="closeModal('settingsModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="settingsUrl">Apps Script URL</label>
                    <input type="url" id="settingsUrl" placeholder="https://script.google.com/macros/s/...">
                </div>
                <div class="form-group">
                    <label for="settingsName">Your Name</label>
                    <input type="text" id="settingsName" placeholder="Your name">
                </div>
                <div class="form-actions">
                    <button class="btn btn-danger" onclick="clearSettings()">Disconnect</button>
                    <button class="btn btn-primary" onclick="updateSettings()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Batch Management Modal -->
    <div id="batchModal" class="modal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h2 id="batchModalTitle">Create Material Batch</h2>
                <button class="btn-close" onclick="closeModal('batchModal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="batchForm" onsubmit="handleBatchSave(event)">
                    <input type="hidden" id="batchId">
                    <div class="form-group">
                        <label for="batchName">Batch Name *</label>
                        <input type="text" id="batchName" required placeholder="e.g., Standard Production Run">
                    </div>

                    <div class="batch-items-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Material Name</th>
                                    <th width="150">Quantity per Batch</th>
                                    <th width="50"></th>
                                </tr>
                            </thead>
                            <tbody id="batchItemsList">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>

                    <div class="form-actions" style="margin-top: 24px;">
                        <button type="button" class="btn btn-secondary"
                            onclick="closeModal('batchModal')">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Batch</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Batch Multiplier Modal -->
    <div id="batchMultiplierModal" class="modal">
        <div class="modal-content modal-xs">
            <div class="modal-header">
                <h2>Batch Multiplier</h2>
                <button class="btn-close" onclick="closeModal('batchMultiplierModal')">√ó</button>
            </div>
            <div class="modal-body">
                <p id="multiplierBatchName" style="font-weight: bold; margin-bottom: 15px;"></p>
                <div class="multiplier-options">
                    <button class="btn btn-outline" onclick="applyBatchWithMultiplier(0.5)">0.5x</button>
                    <button class="btn btn-outline" onclick="applyBatchWithMultiplier(1)">1x</button>
                    <button class="btn btn-outline" onclick="applyBatchWithMultiplier(2)">2x</button>
                    <button class="btn btn-outline" onclick="applyBatchWithMultiplier(3)">3x</button>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>Or type custom multiplier:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="number" id="customMultiplier" step="0.1" min="0" value="1" style="flex: 1;">
                        <button class="btn btn-primary"
                            onclick="applyBatchWithMultiplier(document.getElementById('customMultiplier').value)">Apply</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <span id="toastMessage"></span>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <script src="app.js"></script>
</body>

</html>
